<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Handy links or snippets, and a sentence or two">
<meta name="viewport" content="width=device-width">
<title>Blogmarks</title>
<link href="assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="assets/css/code.css" rel="stylesheet" type="text/css">
<link href="assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://chris48s.github.io/blogmarks/">
<link rel="next" href="index-5.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/2023/side-project/" type="text/html">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
        
    <header id="header"><h1 id="brand"><a href="." title="Blogmarks" rel="home">

        <span id="blog-title">Blogmarks</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="rss.xml">RSS feed</a></li>
                <li><a href="categories/">Tags</a></li>

    

    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/side-project/" class="u-url">So, you want to start a side project?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2023/side-project/" rel="bookmark">
            <time class="published dt-published" datetime="2023-12-03T00:00:00Z" itemprop="datePublished" title="2023-12-03">2023-12-03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Over the years, I have started or worked on many side projects and spent a lot of time maintaining them. This has taught me a lot about what makes a project easy and hard to maintain. This post is a reflection on some of the lessons learned over that time.</p>
<p>First, lets start off with some assumptions:</p>
<ol>
<li>You want to start a side project, not a side hustle. A side hustle is an entrepreneurial exercise. It is something you eventually want to turn into a business or job, even if it is not on day one. The objective of a side project is the creative satisfaction of the project itself. It might be a learning experience, or exploration of personal interests.</li>
<li>Your side project is software or programming related.</li>
<li>The project is in some way public. It might be open source. You want to make something with a userbase or community beyond just yourself.</li>
<li>Crucially, you care about maintaining this project over a period of time. It is not just a throwaway learning exercise.</li>
</ol>
<p>If you are looking to start a side project, this implies you have some time on your hands right now. This is a great place to be, but it won't be true forever. Life happens, and it usually happens unexpectedly.</p>
<p>So, how can we optimise for projects that are low-maintenance or at least projects that require the type of maintenance that can be done on our own terms? A side project that may require attention urgently and unexpectedly can quickly become a burden.</p>
<h3>Third party APIs</h3>
<p>Third Party APIs are one of the most likely sources of sudden and unexpected maintenance tasks. You may or may not get warning when changes happen. If you use an API with authentication or credentials, you probably had to sign up for an account so the upstream service provider probably does at least hold some contact details they could use to inform you of changes. Expect the unexpected from any API where you use public or anonymous access.</p>
<p>Sometimes an API you depend on will:</p>
<ul>
<li>Make a non-backwards compatible change.</li>
<li>Introduce rate limits or enforce stricter rate limits.</li>
<li>Change their terms of service such that your project now violates them in some way. </li>
<li>Withdraw service completely or shut down.</li>
</ul>
<p>All of this is very in vogue at the moment.</p>
<h3>Scrapers</h3>
<p>Web scrapers are like third party APIs, only worse. API authors expect that other people's code depends on their API. They may still choose to make a breaking change anyway, but there is some incentive there to maintain a stable platform for their users. Nobody assumes or cares that your code relies on scraping their website. It certainly won't be a consideration in changing it. You definitely won't get any communication informing you of a change that impacts your code. Website authors may even be actively trying to prevent you from scraping them. Code that relies on web scraping is certain to break at some point. It is matter of <em>when</em>, rather than <em>if</em>.</p>
<h3>Infrastructure</h3>
<p>Any kind of infrastructure you run (web servers, DB, cache, etc) is going to come with some maintenance overhead. Applying security upgrades, backup and restore, ensuring uptime, etc. The exact tasks that come up will vary a bit depending on the type of infrastructure, but could include a mix of tasks that can be planned in advance and things that happen unexpectedly. You can plan or defer applying an upgrade, but data loss requiring a restore from backup will happen when you least expect it.</p>
<p>There are some tradeoffs to be made here. Using a managed service can outsource some of this maintenance. For example, if we consider something like a Postgres DB: Running your own Postgres instance on a VPS leaves everything up to you (of course, with a side project, managing this yourself could be part of the joy or satisfaction). A fully managed service like Heroku Postgres will handle most of this stuff for you transparently. Something like RDS or Fly.io's "semi-managed" Postgres sits somewhere in the middle of those two extremes.</p>
<p>A fully managed service comes with some costs though. A managed service can be it's own source of breaking changes or deprecations. Some platforms have a greater or lesser reputation for stability (think AWS vs GCP ðŸ˜€). The more obvious cost is the literal financial cost though, which brings us on to..</p>
<h3>Finances</h3>
<p>If you go down the route of a project that requires some sort of infrastructure, that has a cost associated with it, and somebody needs to cover that. Maybe you will pay for it out of your own pocket. In general, side projects are not revenue generating and need to run on a modest budget. Often that budget will be zero. Maybe you can run a service using free tier offerings. However, even if you're using it for free, someone is still paying. For the moment, the company offering that "free" service is covering that cost out of marketing budget because offering a free tier is good promotion, but that might not stay true forever. If your project is popular, you might also consider soliciting some sponsorship to cover your costs, either from your community or a corporate sponsor.</p>
<p>Again, funding concerns are another common source of suddenly urgent work.</p>
<ul>
<li>Your project may become more popular, outgrowing your current pricing plan or the level of sponsorship your project currently attracts.</li>
<li>If your project runs on a free tier service, that offering will probably be withdrawn at some point. Most of them are, eventually.</li>
<li>If you have a corporate sponsor, also assume it will not last forever. Sponsorships of open source and community projects are often the first things to be cut when times are tough.</li>
</ul>
<p>All of this can leave you quickly scrambling to migrate to another service, find ways to consume fewer resources, or present an immediate existential threat to your project.</p>
<h3>Personal data</h3>
<p>nopenopenopenopenope</p>
<p>If your side project stores personal data, congratulations. You now have compliance obligations. Choo choo ðŸš‚ All aboard the fun train! A service that stores any kind of personal data (e.g: user accounts) is not a good choice for a side project. This one is a hard no from me.</p>
<h3>It's not all doom and gloom</h3>
<p>That is a list of things that can, to one degree or another, generate some maintenance overhead. So what are some types of projects that don't have any of those characteristics (or at least as few of them as possible)?</p>
<h3>Command line applications (compiled language)</h3>
<p>If your project is distributed as a compiled binary and it doesn't call any external APIs, there are very few externalities that can break this type of project or require attention from you as a maintainer. This is even more true for a statically linked binary. The only real exception to this might be needing to respond to a security issue.</p>
<h3>Command line applications (dynamic language) or Libraries</h3>
<p>This type of project has similar properties to a compiled command line tool. However, with anything that the user installs via <code>pip install</code>, <code>npm install</code>, etc, your dependencies are resolved at install time. This means your previously working code can be broken for some users by non-backwards compatible changes made in an in-range dependency version. In theory SemVer saves us here, but in most languages (other than javascript) it is necessary to support wide ranges. This type of breakage is not super common, but it does happen.</p>
<h3>Static sites</h3>
<p>Static content is good content. If you have the type of static site that can be served from a S3 bucket, there are multiple places that will host it for free and scale it to handle as much traffic as the internet can throw at it. If you do need to move it, it is relatively easy and you have zero infrastructure to maintain.</p>
<p>For a low-maintenance project side project that involves a website, "could this be a static site?" is generally a good question to ask. Sometimes by making a compromise or two, it is possible to get rid of a web server and DB and replace them with a static site. This is usually an advisable tradeoff. A good example of this might be choosing a SSG for your blog, instead of hosting a CMS. (<strong>Edit:</strong> A couple of months after I wrote this I came across this article <a href="https://newsletter.pnote.eu/p/simple-lasts-longer">simple lasts longer</a> by Przemek, which gives a great concrete example of making some tradeoffs to allow a project to be delivered as a static site in preference to running a database).</p>
<p>It is worth noting that this is not true of the type of "static site" which is heavily tied to the specific features of a platform like Vercel or Netlify. These basically have the same tradeoffs as managed infrastructure with the additional downside of vendor lock-in.</p>
<h3>End</h3>
<p>So, that's some thoughts on the characteristics of a low-maintenance side project. Go forth. May your side project bring you many hours of joy and few unexpected urgent maintenance issues.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/bulk-querying-github/" class="u-url">Querying GitHub Repos in Bulk</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2023/bulk-querying-github/" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-18T00:00:00+01:00" itemprop="datePublished" title="2023-09-18">2023-09-18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've recently been working on a tool called <a href="https://github.com/chris48s/pip-abandoned">pip-abandoned</a>, which allows you to search for abandoned and deprecated python packages.</p>
<p>In order to make this, one of the things I needed to do was fetch the <code>archived</code> property for lots of GitHub repositories. Using the GitHub v3 (rest) API, this would need one round-trip per repo. So if I want to fetch the <code>archived</code> property for</p>
<ul>
<li><a href="https://github.com/pygments/pygments">https://github.com/pygments/pygments</a></li>
<li><a href="https://github.com/pycqa/mccabe">https://github.com/pycqa/mccabe</a></li>
<li><a href="https://github.com/readthedocs/commonmark.py">https://github.com/readthedocs/commonmark.py</a></li>
</ul>
<p>then I need to make three API calls:</p>
<ul>
<li><a href="https://api.github.com/repos/pygments/pygments">https://api.github.com/repos/pygments/pygments</a></li>
<li><a href="https://api.github.com/repos/pycqa/mccabe">https://api.github.com/repos/pycqa/mccabe</a></li>
<li><a href="https://api.github.com/repos/readthedocs/commonmark.py">https://api.github.com/repos/readthedocs/commonmark.py</a></li>
</ul>
<p>..and if I had a list of 200 GitHub repos, that would require 200 individual network requests.</p>
<p>Fortunately, GitHub also has a GraphQL API. Using the GraphQL API, we can query more than one repo in a single request. To fetch the same data as above using the GraphQL API, I can make the following query</p>
<div class="code"><pre class="code literal-block"><span class="k">query</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">pygments</span><span class="p">:</span><span class="w"> </span><span class="n">repository</span><span class="p">(</span>
<span class="w">    </span><span class="n">owner</span><span class="p">:</span><span class="w"> </span><span class="s">"pygments"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"pygments"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">isArchived</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nl">mccabe</span><span class="p">:</span><span class="w"> </span><span class="n">repository</span><span class="p">(</span>
<span class="w">    </span><span class="n">owner</span><span class="p">:</span><span class="w"> </span><span class="s">"pycqa"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"mccabe"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">isArchived</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nl">commonmark</span><span class="p">:</span><span class="w"> </span><span class="n">repository</span><span class="p">(</span>
<span class="w">    </span><span class="n">owner</span><span class="p">:</span><span class="w"> </span><span class="s">"readthedocs"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">"commonmark.py"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">isArchived</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>to retrieve the <code>archived</code> property for those three repos in a single round-trip over the network. When querying a large number of repos this is a big benefit.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/always-bet-on-sql/" class="u-url">Always bet on SQL</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2023/always-bet-on-sql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-08-07T00:00:00+01:00" itemprop="datePublished" title="2023-08-07">2023-08-07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I don't often write a spicy opinion piece, but it is spicy opinion time: ORMs are fine, but it is not worth investing too much time into becoming an expert in one.</p>
<p>I first learned SQL over 20 years ago. Everything I learned then is still true now. Lots of other things have also become true in the meantime, but everything I learned then still holds.</p>
<p>I've also used a number of different ORMs in some depth. Some free-standing. Some attached to a particular framework.</p>
<ul>
<li>Django ORM</li>
<li>SQLAlchemy</li>
<li>Doctrine</li>
<li>CakePHP ORM</li>
</ul>
<p>All of those use different design patterns and provide conceptually quite different abstractions over the same underlying SQL. There are some common ideas between them, but if you pick any two from that list there are probably more differences between them than similarities. Only a subset of the knowledge from learning one is directly transferable to another ORM.</p>
<p>ORMs come and go as different languages and frameworks gain or lose traction, but the underlying SQL is a constant.</p>
<p>So here's a rule of thumb: ORMs are fine. They do a useful job. Even if you don't like them, you'll probably end up using one. But any given ORM doesn't really warrant too much energy or attention. Focus on SQL. Understand how an ORM maps onto the underlying SQL and learn your current ORM well enough to make it generate the SQL statement you want under the hood.</p>
<p>There is a good chance that 5 years from now:</p>
<ul>
<li>Anything you learn about SQL today will remain valid and useful, even when transitioning to a new ORM</li>
<li>You are likely to be using a different ORM, and much of your current ORM knowledge may not apply</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/relay-fedi-buzz/" class="u-url">relay.fedi.buzz</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2023/relay-fedi-buzz/" rel="bookmark">
            <time class="published dt-published" datetime="2023-06-26T00:00:00+01:00" itemprop="datePublished" title="2023-06-26">2023-06-26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I self-host my own mastodon instance. I am <a href="https://fed.chris-shaw.dev/@chris">the only user on my server</a> and I only follow a handful of accounts. This means I inhabit a somewhat weakly connected corner of the fediverse. For example, following a tag doesn't act as a useful way for me to discover new posts because it almost exclusively shows me posts from people I am already following, which I know about anyway.</p>
<p>This is a problem that is theoretically solved by ActivityPub Relays, although practically I was never really able to get a handle on which (if any) made sense for me to add to my instance.</p>
<p>That changed recently when I found out about <a href="https://relay.fedi.buzz/">relay.fedi.buzz</a> which allows you to generate ad-hoc follow-only ActivityPub relays for specific tags or instances (the most useful of those being tags IMO). For example, if I want to follow the <code>#python</code> tag, I can add <a href="https://relay.fedi.buzz/tag/python">https://relay.fedi.buzz/tag/python</a> to my instance's relays. That ingests a much wider range of posts featuring that tag into my federated timeline, including from instance I was not already federated with via my follows. Then following that htag from my personal account now allows me to discover new posts on that topic.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/sentry-decorator/" class="u-url">Adding a custom tag to a Sentry event</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2023/sentry-decorator/" rel="bookmark">
            <time class="published dt-published" datetime="2023-05-29T00:00:00+01:00" itemprop="datePublished" title="2023-05-29">2023-05-29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Sentry allows you to enrich captured events by applying
<a href="https://docs.sentry.io/product/sentry-basics/integrate-backend/capturing-errors/#enriching-your-event-data">custom tags and attributes</a>.
I was recently working on a python application where I needed a re-usable
abstraction to express the logic "if function X throws exception Y
then apply this custom <code>key=value</code> tag when we log the exception to Sentry"
in a bunch of places. Here's what I came up with:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">sentry_sdk</span> <span class="kn">import</span> <span class="n">capture_exception</span><span class="p">,</span> <span class="n">push_scope</span>

<span class="k">def</span> <span class="nf">tag_error</span><span class="p">(</span><span class="n">exc_class</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">SystemExit</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">exc_class</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">push_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">scope</span><span class="p">:</span>
                        <span class="n">scope</span><span class="o">.</span><span class="n">set_tag</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="n">capture_exception</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</pre></div>

<p>This gives us a <code>@tag_error</code> decorator, which can be applied to any function. For example:</p>
<div class="code"><pre class="code literal-block"><span class="nd">@tag_error</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="s2">"custom-key"</span><span class="p">,</span> <span class="s2">"custom-value"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_a_thing</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Oh no. A terrible thing has happened."</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>

<p>This will tag any <code>ValueError</code>s raised by calling <code>do_a_thing()</code> with
<code>custom-key=custom-value</code> when we log the exception to sentry.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2022/mocha-markdown/" class="u-url">Generating a GitHub Markdown Summary from Mocha</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2022/mocha-markdown/" rel="bookmark">
            <time class="published dt-published" datetime="2022-09-20T00:00:00+01:00" itemprop="datePublished" title="2022-09-20">2022-09-20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I recently wanted to migrate some CI builds running mocha tests from CircleCI to GitHub Actions. I also wanted to use <a href="https://github.blog/2022-05-09-supercharging-github-actions-with-job-summaries/">Job Summaries</a> to produce a markdown summary of the build. This allows you to output a summary of your workflow run by echoing markdown to a special environment variable called <code>$GITHUB_STEP_SUMMARY</code> e.g: <code>echo '### Hello world! :rocket:' &gt;&gt; $GITHUB_STEP_SUMMARY</code></p>
<p>We run our tests with mocha, which doesn't ship with a markdown output formatter. The "min" formatter was quite close to what I wanted (a markdown summary of any failed tests but a "quiet" output if everything passed). Dumping that to a code fence would have probably been acceptable. Unfortunately our test suite has a number of tests which log output to stdout which made things a bit messy as the "min" formatter also dumps to stdout. So I decided to write a quick script to parse mocha's json output and produce a markdown summary. Doing this also allowed me to uses some nicer formatting than dumping console output into a code fence.</p>
<div class="code"><pre class="code literal-block"><span class="c1">// mocha2md.js</span>

<span class="k">import</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'fs'</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mf">3</span><span class="p">]))</span>

<span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`# </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">\n\n`</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">passes</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`âœ” </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">passes</span><span class="si">}</span><span class="sb"> passed\n`</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">failures</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`âœ– </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">failures</span><span class="si">}</span><span class="sb"> failed\n\n`</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">failures</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">tests</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">err</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">test</span><span class="p">.</span><span class="nx">err</span><span class="p">).</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`### </span><span class="si">${</span><span class="nx">test</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">\n\n`</span><span class="p">)</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">test</span><span class="p">.</span><span class="nx">fullTitle</span><span class="si">}</span><span class="sb">\n\n`</span><span class="p">)</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'```\n'</span><span class="p">)</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">test</span><span class="p">.</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="si">}</span><span class="sb">\n`</span><span class="p">)</span>
<span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">'```\n\n'</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Combine that with some workflow yaml to run the tests with the json reporter and use our script to write the report.</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:core -- --reporter json --reporter-option 'output=reports/test.json'</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Write Markdown Summary</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node mocha2md.js Tests reports/test.json &gt;&gt; $GITHUB_STEP_SUMMARY</span>
</pre></div>

<p>and we've got ourselves a nice little summary report from our mocha tests.</p>
<p><img alt="example markdown summary" src="images/markdown-summary.png"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2022/diagrams/" class="u-url">Diagrams</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2022/diagrams/" rel="bookmark">
            <time class="published dt-published" datetime="2022-09-18T00:00:00+01:00" itemprop="datePublished" title="2022-09-18">2022-09-18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Last week I tried out <a href="https://diagrams.mingrammer.com/">diagrams</a> to knock up some cloud infrastructure diagrams. There are several things I really like about this tool:</p>
<ul>
<li>The learning curve is very easy. I was able to absorb the key concepts and produce a useful diagram showing the AWS setup for an application I am working on within about 30 mins of installing it for the first time.</li>
<li>The [effort in]:[pretty pictures out] ratio is very satisfying.</li>
<li>Because the diagram is generated from code, it can live in your repo. The diff changing the diagram could be in the same commit as the updates to your CDK definitions or ansible playbooks or whatever it is that actually makes the infrastructure changes.</li>
</ul>
<p>For example, the following diagram</p>
<p><img alt="example diagram" src="images/diagram.png"></p>
<p>is generated from this short python snippet:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">diagrams</span> <span class="kn">import</span> <span class="n">Cluster</span><span class="p">,</span> <span class="n">Diagram</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.compute</span> <span class="kn">import</span> <span class="n">Fargate</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.database</span> <span class="kn">import</span> <span class="n">RDS</span><span class="p">,</span> <span class="n">ElastiCache</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.engagement</span> <span class="kn">import</span> <span class="n">SES</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.network</span> <span class="kn">import</span> <span class="n">ELB</span><span class="p">,</span> <span class="n">Route53</span>
<span class="kn">from</span> <span class="nn">diagrams.aws.storage</span> <span class="kn">import</span> <span class="n">S3</span>

<span class="k">with</span> <span class="n">Diagram</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">ses</span> <span class="o">=</span> <span class="n">SES</span><span class="p">(</span><span class="s2">"Mail Transport (SES)"</span><span class="p">)</span>
    <span class="n">dns</span> <span class="o">=</span> <span class="n">Route53</span><span class="p">(</span><span class="s2">"Route 53 (DNS)"</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">S3</span><span class="p">(</span><span class="s2">"S3"</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">"VPC"</span><span class="p">):</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">ELB</span><span class="p">(</span><span class="s2">"Load Balancer (ALB)"</span><span class="p">)</span>
        <span class="n">elasticache</span> <span class="o">=</span> <span class="n">ElastiCache</span><span class="p">(</span><span class="s2">"Redis (ElastiCache)"</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">"ECS"</span><span class="p">):</span>
            <span class="n">web</span> <span class="o">=</span> <span class="n">Fargate</span><span class="p">(</span><span class="s2">"web"</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">Cluster</span><span class="p">(</span><span class="s2">"DB Cluster (RDS)"</span><span class="p">):</span>
            <span class="n">db_primary</span> <span class="o">=</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">"primary"</span><span class="p">)</span>
            <span class="n">db_primary</span> <span class="o">-</span> <span class="n">RDS</span><span class="p">(</span><span class="s2">"read replica"</span><span class="p">)</span>

    <span class="n">dns</span> <span class="o">&gt;&gt;</span> <span class="n">lb</span>
    <span class="n">lb</span> <span class="o">&gt;&gt;</span> <span class="n">web</span>

    <span class="n">web</span> <span class="o">&gt;&gt;</span> <span class="n">elasticache</span>
    <span class="n">web</span> <span class="o">&gt;&gt;</span> <span class="n">db_primary</span>
    <span class="n">web</span> <span class="o">&gt;&gt;</span> <span class="n">s3</span>
    <span class="n">web</span> <span class="o">&gt;&gt;</span> <span class="n">ses</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2022/three-programming-blogs/" class="u-url">Three great programming blogs</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2022/three-programming-blogs/" rel="bookmark">
            <time class="published dt-published" datetime="2022-09-16T00:00:00+01:00" itemprop="datePublished" title="2022-09-16">2022-09-16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>These are some of my favourite programming bloggers. All 3 of these are consistently knocking out quality posts and well worth a follow:</p>
<ol>
<li><a href="https://martinheinz.dev/">Martin Heinz</a></li>
<li><a href="https://adamj.eu/tech">Adam Johnson</a></li>
<li><a href="https://roman.pt/">Roman Imankulov</a></li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2022/rich-tips/" class="u-url">Three Rich tips</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2022/rich-tips/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-13T00:00:00Z" itemprop="datePublished" title="2022-02-13">2022-02-13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've mentioned Will McGugan's excellent library <a href="https://github.com/willmcgugan/rich">Rich</a> on this blog before. It is a great tool for building nice terminal interfaces, but it is also an important local development tool. Here's three top tips:</p>
<ol>
<li>Rich can be registered as a <a href="https://rich.readthedocs.io/en/stable/traceback.html#traceback-handler">handler to render stacktraces</a>. As well as the aesthetics, using Rich to handle stacktraces like this provides additional context which improves the usefulness of error messages in comparison to python's default handler.</li>
<li>
<a href="https://github.com/Textualize/rich#rich-inspect">Rich.inspect</a> can be used to examine a python object at runtime. I used to use <code>dir()</code> or <code>vars()</code> for this, but <code>rich.inspect()</code> is a big step up.</li>
<li>Rich can be used as a log handler. <a href="https://rich.readthedocs.io/en/stable/logging.html">The docs</a> cover how to use it with python's <code>logging</code> module, but Will has also published this <a href="https://www.willmcgugan.com/blog/tech/post/richer-django-logging/">blog post</a> showing how to configure Django to use Rich as the default log handler.</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2021/html5-kitchen-sink/" class="u-url">HTML 5 Kitchen Sink</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                chris48s
            </span></p>
            <p class="dateline">
            <a href="posts/2021/html5-kitchen-sink/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-22T00:00:00Z" itemprop="datePublished" title="2021-12-22">2021-12-22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><a href="https://github.com/dbox/html5-kitchen-sink">HTML 5 Kitchen Sink</a> is really useful for testing out themes and stylesheets. It also has the helpful side effect of introducing me to (or reminding me about) some of the less common HTML5 elements that exist in the spec as I use it.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-5.html" rel="next">Older posts</a>
            </li>
        </ul></nav></main><footer id="footer"><p>
</p>
<p>Contents Â© 2024 chris48s</p>

<ul class="no-bullet">
<li>
    <i class="fab fa-github"></i>
    <a href="https://github.com/chris48s/" target="_blank">Github</a>
  </li>
  <li>
    <i class="fab fa-mastodon"></i>
    <a href="https://fed.chris-shaw.dev/@chris" target="_blank">Mastodon</a>
  </li>
</ul></footer>
</div>
    
            <script src="assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('main#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
