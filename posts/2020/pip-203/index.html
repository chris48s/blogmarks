<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>pip 20.3 | Blogmarks</title>
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://chris48s.github.io/blogmarks/posts/2020/pip-203/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="chris48s">
<link rel="prev" href="../three-psql-settings/" title="Three useful psql settings" type="text/html">
<link rel="next" href="../stdin-or-file/" title="A python CLI app which accepts input from stdin or a file" type="text/html">
<meta property="og:site_name" content="Blogmarks">
<meta property="og:title" content="pip 20.3">
<meta property="og:url" content="https://chris48s.github.io/blogmarks/posts/2020/pip-203/">
<meta property="og:description" content="There is a very long-standing issue on the pip repository: pip needs a dependency resolver. Most language package managers (e.g: composer, bundler, cargo, etc) either use a resolver to derive a consis">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-11-30T00:00:00Z">
<meta property="article:tag" content="packaging">
<meta property="article:tag" content="python">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
        
    <header id="header"><h1 id="brand"><a href="../../../" title="Blogmarks" rel="home">

        <span id="blog-title">Blogmarks</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../../rss.xml">RSS feed</a></li>
                <li><a href="../../../categories/">Tags</a></li>

    

    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">pip 20.3</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    chris48s
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-11-30T00:00:00Z" itemprop="datePublished" title="2020-11-30">2020-11-30</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>There is a very long-standing issue on the pip repository: <a href="https://github.com/pypa/pip/issues/988">pip needs a dependency resolver</a>. Most language package managers (e.g: composer, bundler, cargo, etc) either use a resolver to derive a consistent dependency tree and prevent incompatible installations, or in the case of NPM/yarn allow "broken diamond" resolution (where more than one version of the same package can be installed at the same time). For the longest time, pip has had no true resolver, allowing incompatible dependencies to be installed. Until now..</p>
<p>Today's release of <a href="https://blog.python.org/2020/11/pip-20-3-release-new-resolver.html">Pip 20.3</a> is the culmination of a <a href="https://pyfound.blogspot.com/2020/03/new-pip-resolver-to-roll-out-this-year.html">long programme of work</a> to implement a proper dependency resolver in pip. This makes pip 20.3 the most significant pip release in a very long time, possibly ever.</p>
<p>It has actually been possible to preview this feature for some time using the <code>--use-feature=2020-resolver</code> flag in pip 20.2.x or by installing the beta releases of pip 20.3, but pip 20.3 is the first stable release to enable the new resolver by default. This means that a command like:</p>
<div class="code"><pre class="code literal-block">pip<span class="w"> </span>install<span class="w"> </span><span class="nv">virtualenv</span><span class="o">==</span><span class="m">20</span>.0.2<span class="w"> </span><span class="nv">six</span><span class="o">==</span><span class="m">1</span>.11
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block"><span class="nb">printf</span><span class="w"> </span><span class="s2">"virtualenv==20.0.2\nsix==1.11"</span><span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>

<p>will now not install any new packages and throw a helpful error like:</p>
<div class="code"><pre class="code literal-block">ERROR: Cannot install six==1.11 and virtualenv==20.0.2 because these package versions have conflicting dependencies.

The conflict is caused by:
    The user requested six==1.11
    virtualenv 20.0.2 depends on six&lt;2 and &gt;=1.12.0

To fix this you could try to:
1. loosen the range of package versions you've specified
2. remove package versions to allow pip attempt to solve the dependency conflict

ERROR: ResolutionImpossible: for help visit https://pip.pypa.io/en/latest/user_guide/#fixing-conflicting-dependencies
</pre></div>

<p>which is a <em>massive</em> improvement over the previous behaviour. There is a gotcha though. Resolution only considers the packages being installed in that command. It doesn't take into account other packages already installed in your (virtual) environment. This means running</p>
<div class="code"><pre class="code literal-block">pip<span class="w"> </span>install<span class="w"> </span><span class="nv">virtualenv</span><span class="o">==</span><span class="m">20</span>.0.2<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">six</span><span class="o">==</span><span class="m">1</span>.11
</pre></div>

<p>doesn't fail to install <code>six==1.11</code> with a <code>ResolutionImpossible</code> error. It will still install the incompatible package and warn you that it has done that:</p>
<div class="code"><pre class="code literal-block">ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
ERROR: virtualenv 20.0.2 requires six&lt;2,&gt;=1.12.0, but you'll have six 1.11.0 which is incompatible.
</pre></div>

<p>This isn't a bug. This behaviour is noted in the error message  and <a href="https://pip.pypa.io/en/latest/user_guide/#changes-to-the-pip-dependency-resolver-in-20-3-2020">documented in the release notes</a>, but it is worth understanding this limitation. Even with the new resolver pip will still install incompatible dependencies in your environment if given the right combination of commands. This is a situation it is possible to wander into without realising or consciously enabling the legacy behaviour with <code>--use-deprecated=legacy-resolver</code>. While it is useful to have some further improved messaging around this, it is still a bit of a disappointment.</p>
<p>I've <a href="../2poetry/">previously written</a> about poetry. I'm now using poetry for all projects where I'm the only person who works on it and I have no plan to change that (poetry's behaviour is still more advanced here and IMO preferable), but it is impossible to work in the wider python community without encountering pip. This feature reduces that point of friction and it is great to see, but it isn't a silver bullet for preventing incompatible dependencies. It will be interesting to see how the wider community responds as users encounter this behaviour change for the first time.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/packaging/" rel="tag">packaging</a></li>
            <li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../three-psql-settings/" rel="prev" title="Three useful psql settings">Previous post</a>
            </li>
            <li class="next">
                <a href="../stdin-or-file/" rel="next" title="A python CLI app which accepts input from stdin or a file">Next post</a>
            </li>
        </ul></nav></aside></article></main>
</div>
    
            <script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
