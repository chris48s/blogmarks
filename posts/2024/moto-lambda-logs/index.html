<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Where do the logs from fake lambda go? | Blogmarks</title>
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://chris48s.github.io/blogmarks/posts/2024/moto-lambda-logs/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="chris48s">
<link rel="prev" href="../python-package-manifest-files/" title="An analysis of python package manifest files" type="text/html">
<link rel="next" href="../../2025/moto-lambda-logs/" title="Three lessons from moving to Renovate" type="text/html">
<meta property="og:site_name" content="Blogmarks">
<meta property="og:title" content="Where do the logs from fake lambda go?">
<meta property="og:url" content="https://chris48s.github.io/blogmarks/posts/2024/moto-lambda-logs/">
<meta property="og:description" content="I've written before about moto. It is a library for mocking out AWS services under test, and it is basically magic.
Recently, I was working on a test for some code that invokes an AWS lambda function,">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-10-30T00:00:00Z">
<meta property="article:tag" content="devops">
<meta property="article:tag" content="python">
<meta property="article:tag" content="testing">
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Where do the logs from fake lambda go?",
    "url": "https://chris48s.github.io/blogmarks/posts/2024/moto-lambda-logs/",
    "description": "",
    "author": {
        "@type": "Person",
        "name": "chris48s"
    },
    "mainEntityOfPage": "https://chris48s.github.io/blogmarks/posts/2024/moto-lambda-logs/",
    "datePublished": "2024-10-30",
    "dateCreated": "2024-10-30",
    "dateModified": "2024-10-30"
}
</script>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
        
    <header id="header"><h1 id="brand"><a href="../../../" title="Blogmarks" rel="home">

        <span id="blog-title">Blogmarks</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../../rss.xml">RSS feed</a></li>
                <li><a href="../../../categories/">Tags</a></li>

    

    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Where do the logs from fake lambda go?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    chris48s
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2024-10-30T00:00:00Z" itemprop="datePublished" title="2024-10-30">2024-10-30</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I've written before about <a href="https://docs.getmoto.org/en/latest/">moto</a>. It is a library for mocking out AWS services under test, and it is basically magic.</p>
<p>Recently, I was working on a test for some code that invokes an AWS lambda function, and I was using moto to mock out the lambda service. The fact that moto can do this is quite impressive in itself, but during the course of this I found myself needing some visibility onto what was happening in the lambda while moto was running it in the mock lambda environment. This led me to the question "Where do the logs from fake lambda go?"</p>
<p>It turns out the answer to this question is: "Into fake CloudWatch".</p>
<p>On one level this answer makes complete logical sense. Simultaneously I found this a bit mind-blowing ðŸ¤¯ Moto really is incredibly capable software.</p>
<p>So, armed with this knowledge, how do we use it?</p>
<p>I've pushed a repo with some complete working code demonstrating this to <a href="https://github.com/chris48s/moto-lambda-logs-demo">https://github.com/chris48s/moto-lambda-logs-demo</a>. Here's a cut down version leaving out some imports and helper functions for the sake of brevity.</p>
<p>First lets define a toy lambda function we can test. As well as returning a response, our handler also prints something to stdout.</p>
<div class="code"><pre class="code literal-block"><span class="c1"># handler.py</span>
<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"log message"</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"body"</span><span class="p">:</span> <span class="s2">"Hello from Lambda!"</span><span class="p">}</span>
</pre></div>

<p>We can use moto to run this handler in a mock lambda environment and test the response like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_lambda</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mock_aws</span><span class="p">():</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">_get_mock_role</span><span class="p">()</span>

        <span class="n">lambda_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
            <span class="s2">"lambda"</span><span class="p">,</span>
            <span class="n">region_name</span><span class="o">=</span><span class="s2">"eu-west-1"</span>
        <span class="p">)</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">lambda_client</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span>
            <span class="n">FunctionName</span><span class="o">=</span><span class="s2">"TestLambdaFunction"</span><span class="p">,</span>
            <span class="n">Runtime</span><span class="o">=</span><span class="s2">"python3.10"</span><span class="p">,</span>
            <span class="n">Role</span><span class="o">=</span><span class="n">role</span><span class="p">[</span><span class="s2">"Role"</span><span class="p">][</span><span class="s2">"Arn"</span><span class="p">],</span>
            <span class="n">Handler</span><span class="o">=</span><span class="s2">"handler.lambda_handler"</span><span class="p">,</span>
            <span class="n">Code</span><span class="o">=</span><span class="p">{</span><span class="s2">"ZipFile"</span><span class="p">:</span> <span class="n">_make_lambda_zip</span><span class="p">()},</span>
        <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">lambda_client</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
            <span class="n">FunctionName</span><span class="o">=</span><span class="n">fn</span><span class="p">[</span><span class="s2">"FunctionName"</span><span class="p">],</span>
            <span class="n">Payload</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({}),</span>
        <span class="p">)</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">"Payload"</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">payload</span> <span class="o">==</span> <span class="p">{</span>
                <span class="s2">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                <span class="s2">"body"</span><span class="p">:</span> <span class="s2">"Hello from Lambda!"</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="o">...</span>
</pre></div>

<p>Having invoked the lambda, we can then also inspect the CloudWatch logs generated while running that function and make assertions about anything written to the log streams. In this case, I'm asserting the output of our <code>print()</code> statement made it into the logs.</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_lambda</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mock_aws</span><span class="p">():</span>

        <span class="o">...</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">payload</span> <span class="o">==</span> <span class="p">{</span>
                <span class="s2">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                <span class="s2">"body"</span><span class="p">:</span> <span class="s2">"Hello from Lambda!"</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">logs_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
            <span class="s2">"logs"</span><span class="p">,</span>
            <span class="n">region_name</span><span class="o">=</span><span class="s2">"eu-west-1"</span>
        <span class="p">)</span>
        <span class="n">log_streams</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">describe_log_streams</span><span class="p">(</span>
            <span class="n">logGroupName</span><span class="o">=</span><span class="sa">f</span><span class="s2">"/aws/lambda/</span><span class="si">{</span><span class="n">fn</span><span class="p">[</span><span class="s1">'FunctionName'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"logStreams"</span><span class="p">)</span>

        <span class="n">log_events</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">get_log_events</span><span class="p">(</span>
            <span class="n">logGroupName</span><span class="o">=</span><span class="sa">f</span><span class="s2">"/aws/lambda/</span><span class="si">{</span><span class="n">fn</span><span class="p">[</span><span class="s1">'FunctionName'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="n">logStreamName</span><span class="o">=</span><span class="n">log_streams</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"logStreamName"</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"events"</span><span class="p">)</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">([</span>
                <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">log_events</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"log message"</span>
            <span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">)</span>
</pre></div>

<p>Moto really does provide an exceptionally deep and comprehensive mock AWS environment.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/devops/" rel="tag">devops</a></li>
            <li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../../categories/testing/" rel="tag">testing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../python-package-manifest-files/" rel="prev" title="An analysis of python package manifest files">Previous post</a>
            </li>
            <li class="next">
                <a href="../../2025/moto-lambda-logs/" rel="next" title="Three lessons from moving to Renovate">Next post</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>
</p>
<p>Contents Â© 2025 chris48s</p>

<ul class="no-bullet">
<li>
    <i class="fab fa-github"></i>
    <a href="https://github.com/chris48s/" target="_blank">Github</a>
  </li>
  <li>
    <i class="fab fa-mastodon"></i>
    <a href="https://fed.chris-shaw.dev/@chris" target="_blank">Mastodon</a>
  </li>
</ul></footer>
</div>
    
            <script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('main#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
