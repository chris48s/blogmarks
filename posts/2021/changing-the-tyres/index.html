<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Changing the tyres while the car is moving | Blogmarks</title>
<link href="../../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/custom.css" rel="stylesheet" type="text/css">
<link href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://chris48s.github.io/blogmarks/posts/2021/changing-the-tyres/">
<!--[if lt IE 9]><script src="../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="chris48s">
<link rel="prev" href="../jsontidy/" title="Using jq to format JSON on the clipboard" type="text/html">
<link rel="next" href="../check-migrations/" title="Failing the CI build if django migrations are out of date" type="text/html">
<meta property="og:site_name" content="Blogmarks">
<meta property="og:title" content="Changing the tyres while the car is moving">
<meta property="og:url" content="https://chris48s.github.io/blogmarks/posts/2021/changing-the-tyres/">
<meta property="og:description" content="I am currently working on a project where I need to migrate a legacy test suite from nose to pytest. The codebase has about 7,000 lines of test code. That isn't an enormous test suite, but I'm the onl">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-01-31T00:00:00Z">
<meta property="article:tag" content="python">
<meta property="article:tag" content="testing">
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Changing the tyres while the car is moving",
    "url": "https://chris48s.github.io/blogmarks/posts/2021/changing-the-tyres/",
    "description": "",
    "author": {
        "@type": "Person",
        "name": "chris48s"
    },
    "mainEntityOfPage": "https://chris48s.github.io/blogmarks/posts/2021/changing-the-tyres/",
    "datePublished": "2021-01-31",
    "dateCreated": "2021-01-31",
    "dateModified": "2021-01-31"
}
</script>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
        
    <header id="header"><h1 id="brand"><a href="../../../" title="Blogmarks" rel="home">

        <span id="blog-title">Blogmarks</span>
    </a></h1>

        

        
    <nav id="menu"><ul>
<li><a href="../../../rss.xml">RSS feed</a></li>
                <li><a href="../../../categories/">Tags</a></li>

    

    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Changing the tyres while the car is moving</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    chris48s
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-01-31T00:00:00Z" itemprop="datePublished" title="2021-01-31">2021-01-31</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am currently working on a project where I need to migrate a legacy test suite from nose to pytest. The codebase has about 7,000 lines of test code. That isn't an enormous test suite, but I'm the only person who will be working on it. It will take me a while to get through them all because moving from one test runner to another will require changes to fixtures, factories, etc and maybe some light codebase refactoring as well as just reviewing/updating the test code itself. I also need to balance this with continuing to deliver bugfix and feature work. I can't block all delivery on the test suite migration, so here's a pattern:</p>
<ul>
<li>Split the test suite into two dirs: <code>/tests/nose</code> and <code>/tests/pt</code>
</li>
<li>Migrate one module of test code at a time</li>
<li>Have the CI build run the old tests with nose and the new ones with pytest and merge the coverage reports:</li>
</ul>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run nose tests</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">nosetests</span>
<span class="w">      </span><span class="no">--with-coverage \</span>
<span class="w">      </span><span class="no">--cover-package=dir \</span>
<span class="w">      </span><span class="no">--cover-erase \</span>
<span class="w">      </span><span class="no">path/to/tests/nose</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run pytest tests</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">pytest \</span>
<span class="w">      </span><span class="no">--cov=dir \</span>
<span class="w">      </span><span class="no">--cov-append \</span>
<span class="w">      </span><span class="no">path/to/tests/pt</span>
</pre></div>

<ul>
<li>When I rewrite the last test module left in <code>/tests/nose</code>, we can finally drop nose, delete any nose-specific test helpers and move all the tests from <code>/tests/pt</code> back to <code>/tests</code>.</li>
</ul>
<p>This approach buys me several useful things:</p>
<ul>
<li>I can tackle the test suite migration one module at a time</li>
<li>I can submit small pull requests that are easy to review</li>
<li>I can start writing tests for any new features or bugfixes in pytest right now</li>
<li>I can minimise the chance of conflicts between test suite migration and bugfix/feature delivery</li>
</ul>
<p>This is a very simple example of a high-level general pattern for managing non-trivial migrations (like moving a project from one web framework to another). This can be applied to larger more complex migrations and enables us to "change the tyres while the car is moving" (a phrase I stole from my colleague <a href="https://amercader.net/">Adrià</a>):</p>
<ul>
<li>Set up a structure that allows both <code>$OLD_BORING_THING</code> and <code>$NEW_SHINY_THING</code> to run at the same time</li>
<li>Gradually move code from <code>$OLD_BORING_THING</code> to <code>$NEW_SHINY_THING</code>
</li>
<li>When we migrate the last bit of code from <code>$OLD_BORING_THING</code> to <code>$NEW_SHINY_THING</code>, remove the structure that allows <code>$OLD_BORING_THING</code> and <code>$NEW_SHINY_THING</code> to co-exist and delete <code>$OLD_BORING_THING</code>
</li>
<li>Continue to deliver our roadmap in parallel to the migration</li>
</ul>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../../categories/testing/" rel="tag">testing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../jsontidy/" rel="prev" title="Using jq to format JSON on the clipboard">Previous post</a>
            </li>
            <li class="next">
                <a href="../check-migrations/" rel="next" title="Failing the CI build if django migrations are out of date">Next post</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>
</p>
<p>Contents © 2025 chris48s</p>

<ul class="no-bullet">
<li>
    <i class="fab fa-github"></i>
    <a href="https://github.com/chris48s/" target="_blank">Github</a>
  </li>
  <li>
    <i class="fab fa-mastodon"></i>
    <a href="https://fed.chris-shaw.dev/@chris" target="_blank">Mastodon</a>
  </li>
</ul></footer>
</div>
    
            <script src="../../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('main#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
